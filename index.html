<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CollabCode - IDE Colaborativo en Tiempo Real</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body>
    <!-- Login Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-header">
                <svg width="48" height="48" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="32" height="32" rx="8" fill="url(#gradient)" />
                    <path d="M16 8L21 13L16 18" stroke="white" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <path d="M11 14L16 19L11 24" stroke="white" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>CollabCode</h1>
                <p>IDE Colaborativo en Tiempo Real</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Iniciar Sesión</button>
                <button class="auth-tab" data-tab="register">Registrarse</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="tu@email.com" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contraseña</label>
                    <input type="password" id="loginPassword" placeholder="Contraseña" autocomplete="current-password"
                        required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Iniciar Sesión</button>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">Usuario (para mostrar)</label>
                    <input type="text" id="registerUsername" placeholder="Ej: DevMaster" autocomplete="username"
                        required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="tu@email.com" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Contraseña</label>
                    <input type="password" id="registerPassword" placeholder="Mínimo 6 caracteres"
                        autocomplete="new-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Registrarse</button>
            </form>
        </div>
    </div>

    <!-- Main App (Hidden until logged in) -->
    <div class="main-app" id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="8" fill="url(#gradient2)" />
                        <path d="M16 8L21 13L16 18" stroke="white" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M11 14L16 19L11 24" stroke="white" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <defs>
                            <linearGradient id="gradient2" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#667eea" />
                                <stop offset="100%" stop-color="#764ba2" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <h1>CollabCode</h1>
                </div>
                <div class="project-info">
                    <button class="btn-icon" id="projectsBtn" title="Mis Proyectos">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.5 5H17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M2.5 10H17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M2.5 15H17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                    <div class="current-project" id="currentProject">
                        <span class="project-name">Sin proyecto</span>
                    </div>
                </div>
                <div class="connection-status" id="connectionStatus">
                    <div class="status-dot"></div>
                    <span>Conectando...</span>
                </div>
            </div>
            <div class="header-right">
                <div class="online-users" id="onlineUsers">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M14 17V15C14 13.9391 13.5786 12.9217 12.8284 12.1716C12.0783 11.4214 11.0609 11 10 11H4C2.93913 11 1.92172 11.4214 1.17157 12.1716C0.421427 12.9217 0 13.9391 0 15V17"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <circle cx="7" cy="4" r="4" stroke="currentColor" stroke-width="2" />
                        <path
                            d="M20 17V15C19.9993 14.1137 19.7044 13.2528 19.1614 12.5523C18.6184 11.8519 17.8581 11.3516 17 11.13"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M14 0.13C14.8604 0.3503 15.623 0.8507 16.1676 1.55231C16.7122 2.25392 17.0078 3.11683 17.0078 4.005C17.0078 4.89317 16.7122 5.75608 16.1676 6.45769C15.623 7.1593 14.8604 7.6597 14 7.88"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span id="userCount">0</span>
                </div>
                <div class="user-info" id="userInfo">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="9" cy="5" r="3" stroke="currentColor" stroke-width="2" />
                        <path d="M3 16V14C3 12.3431 4.34315 11 6 11H12C13.6569 11 15 12.3431 15 14V16"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <span id="currentUsername">Usuario</span>
                </div>
                <button class="btn-icon" id="shareBtn" title="Compartir proyecto">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15 6.66667C16.3807 6.66667 17.5 5.54738 17.5 4.16667C17.5 2.78595 16.3807 1.66667 15 1.66667C13.6193 1.66667 12.5 2.78595 12.5 4.16667C12.5 5.54738 13.6193 6.66667 15 6.66667Z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M5 12.5C6.38071 12.5 7.5 11.3807 7.5 10C7.5 8.61929 6.38071 7.5 5 7.5C3.61929 7.5 2.5 8.61929 2.5 10C2.5 11.3807 3.61929 12.5 5 12.5Z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M15 18.3333C16.3807 18.3333 17.5 17.214 17.5 15.8333C17.5 14.4526 16.3807 13.3333 15 13.3333C13.6193 13.3333 12.5 14.4526 12.5 15.8333C12.5 17.214 13.6193 18.3333 15 18.3333Z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M7.15833 11.175L12.85 14.6583" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M12.8417 5.34167L7.15833 8.825" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
                <button class="btn-icon" id="logoutBtn" title="Cerrar sesión">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7.5 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H7.5"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M13.3333 14.1667L17.5 10L13.3333 5.83333" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M17.5 10H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar - File Explorer -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Archivos</h2>
                    <button class="btn-icon" id="newFileBtn" title="Nuevo archivo">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 3.75V14.25" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M3.75 9H14.25" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="file-list" id="fileList">
                    <!-- Files will be dynamically added here -->
                </div>
            </aside>

            <!-- Editor Section -->
            <main class="editor-section">
                <!-- Tabs -->
                <div class="tabs" id="tabs">
                    <!-- Tabs will be dynamically added here -->
                </div>

                <!-- Editor Area -->
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-info">
                            <span class="file-name" id="currentFileName">Sin archivo seleccionado</span>
                            <span class="file-type" id="currentFileType"></span>
                        </div>
                        <div class="editor-actions">
                            <button class="btn-icon" id="formatBtn" title="Formatear código">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 6H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                    <path d="M3 12H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                    <path d="M6 9H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                </svg>
                            </button>
                            <button class="btn-icon" id="deleteFileBtn" title="Eliminar archivo">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2.25 4.5H15.75" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" />
                                    <path d="M7.5 8.25V12.75" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" />
                                    <path d="M10.5 8.25V12.75" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" />
                                    <path
                                        d="M3 4.5H15V15C15 15.3978 14.842 15.7794 14.5607 16.0607C14.2794 16.342 13.8978 16.5 13.5 16.5H4.5C4.10218 16.5 3.72064 16.342 3.43934 16.0607C3.15804 15.7794 3 15.3978 3 15V4.5Z"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path
                                        d="M6 4.5V3C6 2.60218 6.15804 2.22064 6.43934 1.93934C6.72064 1.65804 7.10218 1.5 7.5 1.5H10.5C10.8978 1.5 11.2794 1.65804 11.5607 1.93934C11.842 2.22064 12 2.60218 12 3V4.5"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <textarea class="code-editor" id="codeEditor" spellcheck="false"></textarea>
                    <div class="editor-footer">
                        <div class="cursor-info">
                            <span>Línea: <span id="lineNumber">1</span></span>
                            <span>Columna: <span id="columnNumber">1</span></span>
                        </div>
                        <div class="sync-status" id="syncStatus">
                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12.25 7C12.25 9.8995 9.8995 12.25 7 12.25C4.1005 12.25 1.75 9.8995 1.75 7C1.75 4.1005 4.1005 1.75 7 1.75"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M7 9.625L9.625 7L7 4.375" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span>Sincronizado</span>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Preview Section -->
            <aside class="preview-section">
                <div class="preview-header">
                    <h2>Vista Previa</h2>
                    <div class="preview-actions">
                        <button class="btn-icon" id="refreshPreviewBtn" title="Refrescar vista previa">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.5 3V7.5H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M16.5 15V10.5H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path
                                    d="M15.255 6.75C14.9313 5.76116 14.3905 4.85768 13.6722 4.10737C12.954 3.35706 12.0767 2.78178 11.1051 2.42425C10.1335 2.06672 9.09229 1.93584 8.06134 2.04135C7.03039 2.14687 6.03679 2.48605 5.1525 3.0315L1.5 5.25M16.5 12.75L12.8475 14.9685C11.9632 15.514 10.9696 15.8531 9.93866 15.9587C8.90771 16.0642 7.86652 15.9333 6.89488 15.5757C5.92325 15.2182 5.04604 14.6429 4.32779 13.8926C3.60954 13.1423 3.06874 12.2388 2.745 11.25"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="togglePreviewBtn" title="Minimizar/Maximizar">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.5 4.5L4.5 13.5" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                                <path d="M7.5 4.5H13.5V10.5" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="preview-container">
                    <iframe id="preview" sandbox="allow-scripts allow-modals"></iframe>
                </div>
            </aside>
        </div>

        <!-- Projects Modal -->
        <div class="modal" id="projectsModal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3>Mis Proyectos</h3>
                    <button class="btn-icon" id="closeProjectsModalBtn">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.5 4.5L4.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="projects-header">
                        <button class="btn btn-primary" id="newProjectBtn">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 3.75V14.25" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                <path d="M3.75 9H14.25" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                            Nuevo Proyecto
                        </button>
                    </div>
                    <div class="projects-list" id="projectsList">
                        <!-- Projects will be listed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- New Project Modal -->
        <div class="modal" id="newProjectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nuevo Proyecto</h3>
                    <button class="btn-icon" id="closeNewProjectModalBtn">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.5 4.5L4.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="projectNameInput">Nombre del proyecto:</label>
                    <input type="text" id="projectNameInput" placeholder="Mi Proyecto Genial" autocomplete="off">
                    <label for="projectDescInput">Descripción (opcional):</label>
                    <textarea id="projectDescInput" placeholder="Describe tu proyecto..." rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelNewProjectBtn">Cancelar</button>
                    <button class="btn btn-primary" id="createProjectBtn">Crear Proyecto</button>
                </div>
            </div>
        </div>

        <!-- Share Modal -->
        <div class="modal" id="shareModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Compartir Proyecto</h3>
                    <button class="btn-icon" id="closeShareModalBtn">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.5 4.5L4.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="shareUsernameInput">Usuario a compartir:</label>
                    <input type="text" id="shareUsernameInput" placeholder="Nombre de usuario" autocomplete="off">
                    <div class="share-info">
                        <p>Este usuario podrá ver y editar tu proyecto en tiempo real.</p>
                    </div>
                    <div class="shared-users" id="sharedUsers">
                        <h4>Usuarios con acceso:</h4>
                        <div id="sharedUsersList"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelShareBtn">Cancelar</button>
                    <button class="btn btn-primary" id="addShareBtn">Compartir</button>
                </div>
            </div>
        </div>

        <!-- New File Modal -->
        <div class="modal" id="newFileModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nuevo Archivo</h3>
                    <button class="btn-icon" id="closeModalBtn">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.5 4.5L4.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="fileNameInput">Nombre del archivo:</label>
                    <input type="text" id="fileNameInput" placeholder="ejemplo.html" autocomplete="off">
                    <div class="file-type-suggestions">
                        <button class="file-type-btn" data-extension=".html">HTML</button>
                        <button class="file-type-btn" data-extension=".css">CSS</button>
                        <button class="file-type-btn" data-extension=".js">JavaScript</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelNewFileBtn">Cancelar</button>
                    <button class="btn btn-primary" id="createFileBtn">Crear</button>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- Close main-app -->

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>

</html>